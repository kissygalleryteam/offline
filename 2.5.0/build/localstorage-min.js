define('kg/localstorage',["util","json"],function(require, exports, module) {var e,t,n=require("util"),r=require("json"),a={},s="DEADLINE-KEY";n.mix(a,{init:function(){var n=(new Date).getTime();e=localStorage,t=r.parse(e.getItem(s))||{};for(var i in t)t.hasOwnProperty(i)&&(dateKey=parseInt(t[i],10),dateBet=dateKey-n,0>=dateBet?(this.removeItem(i),delete t[i],this._saveDeadLine()):this._deadlineKey(i,dateBet));return this},setItem:function(n,i,r){if(r){var a=parseInt(r,10),s=(new Date).getTime();t[n]=a+s,this._deadlineKey(n,a),this._saveDeadLine()}return e.setItem(n,i),!0},getItem:function(t){return e.getItem(t)},removeItem:function(n){return e.removeItem(n),delete t[n],this._saveDeadLine(),!this.getItem(n)},clear:function(){return e.clear(),0===this.size()},size:function(){var t=e.length;return e[s]?t-1:t},getAll:function(t){var n,a=e.length,u={};for(i=0;a>i;i++)n=e.key(i),u[n]=e.getItem(n),n===s&&delete u[n];return t?u:r.stringify(u)},timeRemain:function(n){return e[n]?n in t?t[n]-(new Date).getTime():-1:0},usedByte:function(){var n=this.getAll().length;return e[s]&&(n+=r.stringify(t).length,n+=s.length),n},_deadlineKey:function(i,r){var a=this;n.later(function(){e.removeItem(i),delete t[i],a._saveDeadLine()},r)},_saveDeadLine:function(){e.setItem(s,r.stringify(t))}}),module.exports=a;});